{{define "mascot"}}
<!-- Help Mascot - Fixed position, right side of screen -->
<div id="helpMascot" class="fixed right-4 top-24 flex flex-col items-center cursor-pointer group z-40" onclick="openHelpModal()">
    <span class="text-sm text-gray-500 group-hover:text-indigo-600 font-medium mb-2">Need Help?</span>
    <img src="/static/images/mattyfullbody_clear.png" alt="Help Mascot" class="h-44 w-auto object-contain group-hover:scale-105 transition-transform drop-shadow-lg">
</div>

<!-- Help Modal -->
<div id="helpModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-4xl w-full mx-4 max-h-[85vh] overflow-hidden flex flex-col">
        <!-- Header -->
        <div class="p-4 border-b dark:border-gray-700 flex items-center justify-between bg-gradient-to-r from-indigo-500 to-purple-600">
            <div class="flex items-center">
                <img src="/static/images/mattyfullbody_clear.png" alt="Matty" class="w-10 h-10 mr-3 bg-white rounded-full p-1">
                <h2 class="text-xl font-bold text-white">CareCompanion Help Center</h2>
            </div>
            <button onclick="closeHelpModal()" class="text-white hover:text-gray-200">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>

        <!-- Breadcrumb -->
        <div id="helpBreadcrumb" class="px-4 py-2 bg-gray-50 dark:bg-gray-700 border-b dark:border-gray-600 text-sm hidden">
            <nav class="flex items-center space-x-2">
                <button onclick="showHelpHome()" class="text-indigo-600 dark:text-indigo-400 hover:underline">Home</button>
                <span id="breadcrumbSeparator" class="text-gray-400 hidden">&gt;</span>
                <span id="breadcrumbCurrent" class="text-gray-600 dark:text-gray-300"></span>
            </nav>
        </div>

        <!-- Search -->
        <div class="p-4 border-b dark:border-gray-700">
            <div class="relative">
                <input type="text" id="helpSearchInput" placeholder="Search help topics..."
                       class="w-full pl-10 pr-4 py-3 border dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                       oninput="searchHelp(this.value)">
                <svg class="w-5 h-5 text-gray-400 absolute left-3 top-1/2 transform -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
            </div>
        </div>

        <!-- Content Area -->
        <div class="flex-1 overflow-hidden flex">
            <!-- Sidebar -->
            <div id="helpSidebar" class="w-56 border-r dark:border-gray-700 overflow-y-auto bg-gray-50 dark:bg-gray-900 hidden md:block">
                <div class="p-3">
                    <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2">Pages</h3>
                    <nav class="space-y-1" id="sidebarPages"></nav>
                    <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mt-4 mb-2">Entry Forms</h3>
                    <nav class="space-y-1" id="sidebarForms"></nav>
                </div>
            </div>

            <!-- Main Content -->
            <div id="helpContent" class="flex-1 overflow-y-auto p-6">
                <!-- Home view with categories -->
                <div id="helpHome">
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">Welcome to CareCompanion Help</h3>
                        <p class="text-gray-600 dark:text-gray-300">Select a topic below or use the search to find what you need.</p>
                    </div>

                    <h4 class="text-sm font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3">Application Pages</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-6" id="helpPagesGrid"></div>

                    <h4 class="text-sm font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3">Daily Log Entry Forms</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3" id="helpFormsGrid"></div>
                </div>

                <!-- Topic detail view -->
                <div id="helpTopicDetail" class="hidden"></div>

                <!-- Search results view -->
                <div id="helpSearchResults" class="hidden"></div>
            </div>
        </div>
    </div>
</div>

<script>
// Comprehensive Help Data
const helpData = {
    pages: {
        'dashboard': {
            title: 'Family Dashboard',
            icon: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>',
            color: 'indigo',
            description: 'Your central hub for managing your family',
            content: `
                <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Overview</h4>
                <p class="text-gray-600 dark:text-gray-300 mb-4">The Family Dashboard is your starting point after logging in. It displays all children in your current family and provides quick access to their individual dashboards.</p>

                <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Features</h4>
                <ul class="space-y-2 text-gray-600 dark:text-gray-300 mb-4">
                    <li class="flex items-start"><span class="text-indigo-500 mr-2">•</span><strong>Child Cards:</strong> Each child appears as a card showing their name. Click to view their dashboard.</li>
                    <li class="flex items-start"><span class="text-indigo-500 mr-2">•</span><strong>Add Child:</strong> Click the "+ Add Child" card to register a new child in your family.</li>
                    <li class="flex items-start"><span class="text-indigo-500 mr-2">•</span><strong>Family Switching:</strong> If you belong to multiple families, use the dropdown to switch between them.</li>
                    <li class="flex items-start"><span class="text-indigo-500 mr-2">•</span><strong>Navigation:</strong> Access Chat and Settings from the top navigation bar.</li>
                </ul>

                <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Tips</h4>
                <ul class="space-y-2 text-gray-600 dark:text-gray-300">
                    <li class="flex items-start"><span class="text-green-500 mr-2">✓</span>Click on a child's card to see their detailed dashboard with health metrics.</li>
                    <li class="flex items-start"><span class="text-green-500 mr-2">✓</span>The greeting shows your name - click Settings to update your profile.</li>
                </ul>
            `
        },
        'child-dashboard': {
            title: 'Child Dashboard',
            icon: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>',
            color: 'blue',
            description: 'Individual child overview and quick summary',
            content: `
                <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Overview</h4>
                <p class="text-gray-600 dark:text-gray-300 mb-4">The Child Dashboard provides an overview of a specific child's data, including quick summaries and navigation to detailed sections.</p>

                <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Features</h4>
                <ul class="space-y-2 text-gray-600 dark:text-gray-300 mb-4">
                    <li class="flex items-start"><span class="text-blue-500 mr-2">•</span><strong>Profile Header:</strong> Shows the child's name, age, and provides access to edit their profile.</li>
                    <li class="flex items-start"><span class="text-blue-500 mr-2">•</span><strong>Quick Summary:</strong> Select a category (Behavior, Sleep, Diet, etc.) to see recent data at a glance.</li>
                    <li class="flex items-start"><span class="text-blue-500 mr-2">•</span><strong>Navigation Tabs:</strong> Access Daily Logs, Medications, Alerts, and Insights.</li>
                    <li class="flex items-start"><span class="text-blue-500 mr-2">•</span><strong>Switch Child:</strong> If you have multiple children, quickly switch between them.</li>
                    <li class="flex items-start"><span class="text-blue-500 mr-2">•</span><strong>Active Alerts:</strong> Important alerts appear at the top of the page.</li>
                </ul>

                <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Quick Summary Categories</h4>
                <ul class="space-y-1 text-gray-600 dark:text-gray-300">
                    <li><strong>Behavior:</strong> Mood, energy, meltdowns, and behavioral patterns</li>
                    <li><strong>Sleep:</strong> Sleep duration, quality, and disturbances</li>
                    <li><strong>Diet:</strong> Meals, appetite, and eating patterns</li>
                    <li><strong>Bowel:</strong> Digestive health tracking</li>
                    <li><strong>Speech:</strong> Communication progress</li>
                    <li><strong>Sensory:</strong> Sensory regulation status</li>
                    <li><strong>Social:</strong> Social interaction metrics</li>
                    <li><strong>Therapy:</strong> Therapy session summaries</li>
                </ul>
            `
        },
        'daily-logs': {
            title: 'Daily Logs',
            icon: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg>',
            color: 'green',
            description: 'Record daily activities, behaviors, and observations',
            content: `
                <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Overview</h4>
                <p class="text-gray-600 dark:text-gray-300 mb-4">Daily Logs is where you record observations about your child's day. Consistent logging helps identify patterns and provides valuable data for insights.</p>

                <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Features</h4>
                <ul class="space-y-2 text-gray-600 dark:text-gray-300 mb-4">
                    <li class="flex items-start"><span class="text-green-500 mr-2">•</span><strong>Daily/Weekly View:</strong> Toggle between viewing one day or a full week.</li>
                    <li class="flex items-start"><span class="text-green-500 mr-2">•</span><strong>Date Navigation:</strong> Use arrows to move between days/weeks, or click the date to jump to a specific date.</li>
                    <li class="flex items-start"><span class="text-green-500 mr-2">•</span><strong>Medications Due:</strong> See scheduled medications for the day and log when given.</li>
                    <li class="flex items-start"><span class="text-green-500 mr-2">•</span><strong>Add Entry:</strong> Click any entry type button to record a new observation.</li>
                    <li class="flex items-start"><span class="text-green-500 mr-2">•</span><strong>Entry History:</strong> View and edit past entries by clicking on them.</li>
                </ul>

                <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Entry Types</h4>
                <div class="grid grid-cols-2 gap-2 text-sm text-gray-600 dark:text-gray-300">
                    <div><span class="text-red-500">●</span> Behavior - Mood, energy, incidents</div>
                    <div><span class="text-green-500">●</span> Diet - Meals and nutrition</div>
                    <div><span class="text-purple-500">●</span> Sleep - Rest patterns</div>
                    <div><span class="text-amber-500">●</span> Bowel - Digestive health</div>
                    <div><span class="text-teal-500">●</span> Speech - Communication</div>
                    <div><span class="text-orange-500">●</span> Sensory - Regulation</div>
                    <div><span class="text-cyan-500">●</span> Social - Interactions</div>
                    <div><span class="text-indigo-500">●</span> Therapy - Sessions</div>
                    <div><span class="text-rose-500">●</span> Seizure - Episodes</div>
                    <div><span class="text-pink-500">●</span> Weight - Growth</div>
                </div>

                <h4 class="font-semibold text-gray-900 dark:text-white mt-4 mb-3">Tips</h4>
                <ul class="space-y-2 text-gray-600 dark:text-gray-300">
                    <li class="flex items-start"><span class="text-green-500 mr-2">✓</span>Log entries as close to the event as possible for accuracy.</li>
                    <li class="flex items-start"><span class="text-green-500 mr-2">✓</span>Use "Day" scope for daily summaries, "Momentary" for specific incidents.</li>
                    <li class="flex items-start"><span class="text-green-500 mr-2">✓</span>The more data you log, the better the AI insights become.</li>
                </ul>
            `
        },
        'medications': {
            title: 'Medications',
            icon: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path></svg>',
            color: 'purple',
            description: 'Manage medications and track doses',
            content: `
                <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Overview</h4>
                <p class="text-gray-600 dark:text-gray-300 mb-4">The Medications page helps you manage all medications for your child, set up dosing schedules, and track when doses are given.</p>

                <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Features</h4>
                <ul class="space-y-2 text-gray-600 dark:text-gray-300 mb-4">
                    <li class="flex items-start"><span class="text-purple-500 mr-2">•</span><strong>Add Medication:</strong> Search our FDA-approved database to add medications. Enter dosage and schedule information.</li>
                    <li class="flex items-start"><span class="text-purple-500 mr-2">•</span><strong>Active Medications:</strong> View all current medications with dosage and schedule at a glance.</li>
                    <li class="flex items-start"><span class="text-purple-500 mr-2">•</span><strong>Drug Interactions:</strong> Automatic alerts if potential interactions are detected between medications.</li>
                    <li class="flex items-start"><span class="text-purple-500 mr-2">•</span><strong>Log Doses:</strong> Record when medications are given, skipped, or refused.</li>
                    <li class="flex items-start"><span class="text-purple-500 mr-2">•</span><strong>Edit/Deactivate:</strong> Update medication details or mark medications as inactive.</li>
                </ul>

                <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Drug Interaction Alerts</h4>
                <p class="text-gray-600 dark:text-gray-300 mb-2">When potential interactions are detected:</p>
                <ul class="space-y-1 text-gray-600 dark:text-gray-300 mb-4">
                    <li class="flex items-start"><span class="text-red-500 mr-2">!</span>Review the alert carefully with your healthcare provider</li>
                    <li class="flex items-start"><span class="text-red-500 mr-2">!</span>You can acknowledge the alert after consulting with your doctor</li>
                    <li class="flex items-start"><span class="text-red-500 mr-2">!</span>Never stop medications without medical guidance</li>
                </ul>

                <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Tips</h4>
                <ul class="space-y-2 text-gray-600 dark:text-gray-300">
                    <li class="flex items-start"><span class="text-green-500 mr-2">✓</span>Keep medication information up to date, including dosage changes.</li>
                    <li class="flex items-start"><span class="text-green-500 mr-2">✓</span>Use the "As Needed" medication entry for PRN medications.</li>
                    <li class="flex items-start"><span class="text-green-500 mr-2">✓</span>Log doses consistently to track adherence patterns.</li>
                </ul>
            `
        },
        'alerts': {
            title: 'Alerts',
            icon: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path></svg>',
            color: 'amber',
            description: 'AI-detected patterns and important notifications',
            content: `
                <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Overview</h4>
                <p class="text-gray-600 dark:text-gray-300 mb-4">Alerts are AI-generated notifications based on patterns detected in your logged data. They help identify trends that might need attention.</p>

                <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Alert Severity Levels</h4>
                <ul class="space-y-3 text-gray-600 dark:text-gray-300 mb-4">
                    <li class="flex items-start">
                        <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-red-100 text-red-800 mr-2">Critical</span>
                        <span>Requires immediate attention. These patterns may indicate health concerns that should be discussed with healthcare providers.</span>
                    </li>
                    <li class="flex items-start">
                        <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-amber-100 text-amber-800 mr-2">Warning</span>
                        <span>Important pattern noticed. Worth monitoring closely and considering interventions.</span>
                    </li>
                    <li class="flex items-start">
                        <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-blue-100 text-blue-800 mr-2">Info</span>
                        <span>Helpful observation or positive trend. Good to be aware of but not urgent.</span>
                    </li>
                </ul>

                <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Features</h4>
                <ul class="space-y-2 text-gray-600 dark:text-gray-300 mb-4">
                    <li class="flex items-start"><span class="text-amber-500 mr-2">•</span><strong>Alert Statistics:</strong> See counts of active alerts by severity.</li>
                    <li class="flex items-start"><span class="text-amber-500 mr-2">•</span><strong>Alert Analysis:</strong> Click an alert to see detailed analysis with supporting data.</li>
                    <li class="flex items-start"><span class="text-amber-500 mr-2">•</span><strong>Parent vs Clinical View:</strong> Toggle between simplified and detailed views.</li>
                </ul>

                <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Tips</h4>
                <ul class="space-y-2 text-gray-600 dark:text-gray-300">
                    <li class="flex items-start"><span class="text-green-500 mr-2">✓</span>Review alerts regularly, especially critical ones.</li>
                    <li class="flex items-start"><span class="text-green-500 mr-2">✓</span>Share alert information with healthcare providers during visits.</li>
                    <li class="flex items-start"><span class="text-green-500 mr-2">✓</span>More logged data = more accurate pattern detection.</li>
                </ul>
            `
        },
        'insights': {
            title: 'Insights',
            icon: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>',
            color: 'yellow',
            description: 'Discover correlations and patterns in your data',
            content: `
                <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Overview</h4>
                <p class="text-gray-600 dark:text-gray-300 mb-4">Insights shows correlations discovered by our AI analyzing your logged data. These patterns can help you understand cause-and-effect relationships.</p>

                <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Understanding Insights</h4>
                <ul class="space-y-2 text-gray-600 dark:text-gray-300 mb-4">
                    <li class="flex items-start"><span class="text-yellow-500 mr-2">•</span><strong>Correlation Strength:</strong> How strongly two factors are related (0.0 to 1.0). Higher = stronger relationship.</li>
                    <li class="flex items-start"><span class="text-yellow-500 mr-2">•</span><strong>Confidence:</strong> How certain we are about the pattern based on available data.</li>
                    <li class="flex items-start"><span class="text-yellow-500 mr-2">•</span><strong>Sample Size:</strong> Number of data points used to identify the pattern.</li>
                    <li class="flex items-start"><span class="text-yellow-500 mr-2">•</span><strong>Times Confirmed:</strong> How often the pattern has repeated.</li>
                    <li class="flex items-start"><span class="text-yellow-500 mr-2">•</span><strong>Lag Hours:</strong> Time between cause and effect (e.g., poor sleep → behavior issues 8 hours later).</li>
                </ul>

                <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Example Insights</h4>
                <ul class="space-y-1 text-gray-600 dark:text-gray-300 mb-4">
                    <li>"Poor sleep correlates with increased meltdowns next day"</li>
                    <li>"Sensory overload episodes increase before thunderstorms"</li>
                    <li>"Dairy consumption correlates with digestive issues"</li>
                    <li>"Therapy days show improved social interaction"</li>
                </ul>

                <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Tips</h4>
                <ul class="space-y-2 text-gray-600 dark:text-gray-300">
                    <li class="flex items-start"><span class="text-green-500 mr-2">✓</span>Insights require at least 2 weeks of consistent data.</li>
                    <li class="flex items-start"><span class="text-green-500 mr-2">✓</span>Correlation doesn't always mean causation - discuss with professionals.</li>
                    <li class="flex items-start"><span class="text-green-500 mr-2">✓</span>Use insights to guide conversations with therapists and doctors.</li>
                </ul>
            `
        },
        'chat': {
            title: 'Family Chat',
            icon: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg>',
            color: 'blue',
            description: 'Communicate with family members and caregivers',
            content: `
                <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Overview</h4>
                <p class="text-gray-600 dark:text-gray-300 mb-4">Family Chat allows all caregivers in your family to communicate securely about your children's care.</p>

                <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Features</h4>
                <ul class="space-y-2 text-gray-600 dark:text-gray-300 mb-4">
                    <li class="flex items-start"><span class="text-blue-500 mr-2">•</span><strong>Conversation Threads:</strong> Create separate threads for different topics or children.</li>
                    <li class="flex items-start"><span class="text-blue-500 mr-2">•</span><strong>New Thread:</strong> Click the + button to start a new conversation.</li>
                    <li class="flex items-start"><span class="text-blue-500 mr-2">•</span><strong>Participants:</strong> Add or remove family members from threads.</li>
                    <li class="flex items-start"><span class="text-blue-500 mr-2">•</span><strong>Child-Specific:</strong> Tag threads to specific children for organization.</li>
                    <li class="flex items-start"><span class="text-blue-500 mr-2">•</span><strong>Unread Badges:</strong> See which threads have new messages.</li>
                </ul>

                <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Use Cases</h4>
                <ul class="space-y-1 text-gray-600 dark:text-gray-300 mb-4">
                    <li>• Coordinate care between parents and grandparents</li>
                    <li>• Share updates with babysitters or nannies</li>
                    <li>• Discuss observations and concerns</li>
                    <li>• Plan appointments and therapy schedules</li>
                </ul>

                <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Tips</h4>
                <ul class="space-y-2 text-gray-600 dark:text-gray-300">
                    <li class="flex items-start"><span class="text-green-500 mr-2">✓</span>Create separate threads for different topics to stay organized.</li>
                    <li class="flex items-start"><span class="text-green-500 mr-2">✓</span>Use @mentions to notify specific family members.</li>
                </ul>
            `
        },
        'settings': {
            title: 'User Settings',
            icon: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>',
            color: 'gray',
            description: 'Manage your profile and family settings',
            content: `
                <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Overview</h4>
                <p class="text-gray-600 dark:text-gray-300 mb-4">User Settings allows you to manage your personal profile, view your families, and change your password.</p>

                <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Sections</h4>
                <ul class="space-y-2 text-gray-600 dark:text-gray-300 mb-4">
                    <li class="flex items-start"><span class="text-gray-500 mr-2">•</span><strong>Profile Information:</strong> Update your first name, last name, and phone number.</li>
                    <li class="flex items-start"><span class="text-gray-500 mr-2">•</span><strong>Your Families:</strong> See all families you belong to. Click to switch to that family.</li>
                    <li class="flex items-start"><span class="text-gray-500 mr-2">•</span><strong>Family Members:</strong> View and manage members of your current family.</li>
                    <li class="flex items-start"><span class="text-gray-500 mr-2">•</span><strong>Change Password:</strong> Update your account password (requires current password).</li>
                </ul>

                <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Family Member Roles</h4>
                <ul class="space-y-1 text-gray-600 dark:text-gray-300 mb-4">
                    <li><strong>Admin:</strong> Can manage family settings, add/remove members</li>
                    <li><strong>Member:</strong> Can view and log data for all children</li>
                    <li><strong>Viewer:</strong> Read-only access to child data</li>
                </ul>

                <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Tips</h4>
                <ul class="space-y-2 text-gray-600 dark:text-gray-300">
                    <li class="flex items-start"><span class="text-green-500 mr-2">✓</span>Keep your email address current for password recovery.</li>
                    <li class="flex items-start"><span class="text-green-500 mr-2">✓</span>Add all caregivers as family members for coordinated care.</li>
                </ul>
            `
        },
        'child-settings': {
            title: 'Child Settings',
            icon: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>',
            color: 'teal',
            description: 'Edit child profile and medical conditions',
            content: `
                <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Overview</h4>
                <p class="text-gray-600 dark:text-gray-300 mb-4">Child Settings allows you to edit a child's profile information and manage their medical conditions.</p>

                <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Profile Fields</h4>
                <ul class="space-y-2 text-gray-600 dark:text-gray-300 mb-4">
                    <li class="flex items-start"><span class="text-teal-500 mr-2">•</span><strong>First Name:</strong> Child's first name (required).</li>
                    <li class="flex items-start"><span class="text-teal-500 mr-2">•</span><strong>Last Name:</strong> Child's last name (optional).</li>
                    <li class="flex items-start"><span class="text-teal-500 mr-2">•</span><strong>Date of Birth:</strong> Used to calculate age and track growth.</li>
                    <li class="flex items-start"><span class="text-teal-500 mr-2">•</span><strong>Gender:</strong> Affects dashboard color theme and growth charts.</li>
                    <li class="flex items-start"><span class="text-teal-500 mr-2">•</span><strong>Notes:</strong> Additional information about the child.</li>
                </ul>

                <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Conditions</h4>
                <p class="text-gray-600 dark:text-gray-300 mb-2">Add diagnoses and conditions for better-tailored insights:</p>
                <ul class="space-y-1 text-gray-600 dark:text-gray-300">
                    <li>• Autism Spectrum Disorder</li>
                    <li>• ADHD</li>
                    <li>• Sensory Processing Disorder</li>
                    <li>• Epilepsy</li>
                    <li>• And others...</li>
                </ul>
            `
        },
        'new-child': {
            title: 'Add New Child',
            icon: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path></svg>',
            color: 'green',
            description: 'Register a new child in your family',
            content: `
                <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Overview</h4>
                <p class="text-gray-600 dark:text-gray-300 mb-4">Add a new child to your family to start tracking their care.</p>

                <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Required Information</h4>
                <ul class="space-y-2 text-gray-600 dark:text-gray-300 mb-4">
                    <li class="flex items-start"><span class="text-green-500 mr-2">•</span><strong>First Name:</strong> Required. The name shown on cards and dashboards.</li>
                    <li class="flex items-start"><span class="text-green-500 mr-2">•</span><strong>Date of Birth:</strong> Required. Used for age calculation and growth tracking.</li>
                </ul>

                <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Optional Information</h4>
                <ul class="space-y-2 text-gray-600 dark:text-gray-300 mb-4">
                    <li class="flex items-start"><span class="text-gray-500 mr-2">•</span><strong>Last Name:</strong> Can be added later in settings.</li>
                    <li class="flex items-start"><span class="text-gray-500 mr-2">•</span><strong>Gender:</strong> Affects dashboard colors (blue/pink/neutral).</li>
                    <li class="flex items-start"><span class="text-gray-500 mr-2">•</span><strong>Notes:</strong> Any additional information.</li>
                </ul>

                <h4 class="font-semibold text-gray-900 dark:text-white mb-3">After Adding</h4>
                <p class="text-gray-600 dark:text-gray-300">Once added, you can:</p>
                <ul class="space-y-1 text-gray-600 dark:text-gray-300 mt-2">
                    <li>• Add medical conditions in Child Settings</li>
                    <li>• Set up medications</li>
                    <li>• Start logging daily observations</li>
                </ul>
            `
        },
        'new-family': {
            title: 'Create New Family',
            icon: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>',
            color: 'indigo',
            description: 'Create a new family group',
            content: `
                <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Overview</h4>
                <p class="text-gray-600 dark:text-gray-300 mb-4">Create a new family to organize care tracking. You can belong to multiple families if needed.</p>

                <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Required Information</h4>
                <ul class="space-y-2 text-gray-600 dark:text-gray-300 mb-4">
                    <li class="flex items-start"><span class="text-indigo-500 mr-2">•</span><strong>Family Name:</strong> A name to identify this family (e.g., "Johnson Family", "Primary Caregivers").</li>
                </ul>

                <h4 class="font-semibold text-gray-900 dark:text-white mb-3">After Creating</h4>
                <p class="text-gray-600 dark:text-gray-300">Once created:</p>
                <ul class="space-y-1 text-gray-600 dark:text-gray-300 mt-2">
                    <li>• Add children to the family</li>
                    <li>• Invite other caregivers as family members</li>
                    <li>• Start logging and tracking</li>
                </ul>

                <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Multiple Families</h4>
                <p class="text-gray-600 dark:text-gray-300">Use cases for multiple families:</p>
                <ul class="space-y-1 text-gray-600 dark:text-gray-300 mt-2">
                    <li>• Separate families for divorced/co-parenting situations</li>
                    <li>• Professional caregivers managing multiple families</li>
                    <li>• Grandparents with separate tracking for their home</li>
                </ul>
            `
        }
    },
    entryForms: {
        'behavior': {
            title: 'Behavior Entry',
            icon: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>',
            color: 'red',
            description: 'Track mood, energy, and behavioral incidents',
            fields: [
                { name: 'Mood (1-10)', help: 'Rate overall emotional state. 1 = very negative/upset, 5 = neutral, 10 = very positive/happy. Consider their general demeanor throughout the period.' },
                { name: 'Energy (1-10)', help: 'Activity and energy level. 1 = lethargic/no energy, 5 = normal activity, 10 = hyperactive/can\'t sit still. Consider both physical and mental energy.' },
                { name: 'Anxiety (1-10)', help: 'Level of worry, stress, or nervousness. 1 = completely calm, 5 = moderate worry, 10 = severe anxiety/panic. Look for signs like pacing, nail-biting, or verbal expressions of worry.' },
                { name: 'Interpersonal Behavior', help: 'How engaged they were with others. Withdrawn = avoided all interaction, Somewhat Withdrawn = minimal engagement, Neutral = typical level, Somewhat Interactive = more engaged than usual, Interactive = actively sought connection.' },
                { name: 'Stimming Level', help: 'Self-stimulatory behaviors like hand-flapping, rocking, spinning, or repetitive sounds. None = not observed, Low = occasional, Moderate = frequent, High = constant or intense.' },
                { name: 'Meltdowns', help: 'Count of emotional dysregulation episodes - intense outbursts that the child cannot control. Different from tantrums, meltdowns are overwhelming responses to sensory or emotional overload.' },
                { name: 'Aggression Incidents', help: 'Count of aggressive behaviors toward others (hitting, kicking, biting, throwing things at people). Include verbal aggression if severe.' },
                { name: 'Self-Injury Incidents', help: 'Count of self-harming behaviors (head banging, biting self, hitting self, scratching). Important to track for safety and intervention planning.' },
                { name: 'Location', help: 'Where the behaviors primarily occurred. Helps identify environmental triggers. Select "Other" and specify for locations like grandparents\' house, park, store, etc.' },
                { name: 'Triggers', help: 'What seemed to cause or precede behaviors. Enter comma-separated (e.g., "loud noise, change in routine, tired"). Identifying triggers helps with prevention.' },
                { name: 'Behaviors', help: 'Notable behaviors observed, both positive and negative. Enter comma-separated (e.g., "shared toys, made eye contact, completed task"). Tracking positive behaviors is important too!' },
                { name: 'Notes', help: 'Any additional context or observations. What interventions worked? What made things better or worse? Any unusual circumstances?' },
                { name: 'Time Scope', help: '"Day" = summary of the entire day. "Momentary" = specific incident at a particular time. Use Momentary for logging individual meltdowns or significant events.' },
                { name: 'Date', help: 'The date these behaviors occurred. Can be backdated to log previous days.' },
                { name: 'Time', help: 'For Momentary entries only. The specific time the incident occurred.' }
            ]
        },
        'sleep': {
            title: 'Sleep Entry',
            icon: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>',
            color: 'purple',
            description: 'Record sleep duration and quality',
            fields: [
                { name: 'Bedtime', help: 'Time child went to bed (not necessarily when they fell asleep). Helps track sleep routine consistency.' },
                { name: 'Wake Time', help: 'Time child woke up in the morning. Final wake time, not middle-of-night wakings.' },
                { name: 'Sleep Quality', help: 'Overall assessment of how restful the sleep was. Excellent = slept soundly, Good = minor disturbances, Fair = restless, Poor = very disturbed sleep.' },
                { name: 'Total Sleep (Hours/Minutes)', help: 'Actual hours and minutes of sleep (excluding time awake). If unsure, estimate based on bedtime, wake time, and wakings.' },
                { name: 'Night Wakings', help: 'Number of times child woke during the night. Include all wakings, even brief ones.' },
                { name: 'Nightmares', help: 'Check if child had bad dreams. They may report scary dreams or wake distressed.' },
                { name: 'Bed Wetting', help: 'Check if bed wetting occurred. Tracking helps identify patterns (stress, fluid intake, etc.).' },
                { name: 'Took Sleep Aid', help: 'Check if any medication or supplement was used to help with sleep (melatonin, prescription sleep aids, etc.).' },
                { name: 'Sleep Aid Name', help: 'Name of the sleep aid used. Helps track what interventions are being tried.' },
                { name: 'Notes', help: 'Additional observations: What time did they actually fall asleep? Any sleep talking/walking? Snoring? Restless legs?' }
            ]
        },
        'diet': {
            title: 'Diet Entry',
            icon: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg>',
            color: 'green',
            description: 'Log meals, appetite, and nutrition',
            fields: [
                { name: 'Meal Type', help: 'Breakfast, Lunch, Dinner, or Snack. Log each meal separately for better tracking.' },
                { name: 'Appetite Level', help: 'How hungry were they? High = very hungry/ate a lot, Normal = typical appetite, Low = not very hungry, None = refused to eat.' },
                { name: 'Foods Eaten', help: 'List foods consumed, separated by commas. Be specific when possible (e.g., "scrambled eggs, wheat toast, orange juice").' },
                { name: 'Foods Refused', help: 'List foods offered but rejected. Helps track food aversions and selectivity patterns.' },
                { name: 'Water Intake (oz)', help: 'Fluid consumed in ounces. Include water, juice, milk, etc. Important for hydration tracking.' },
                { name: 'New Food Tried', help: 'Name of any new food introduced. Tracking food trials is important for expanding diet.' },
                { name: 'New Food Acceptance', help: 'How they responded to the new food: Touch Lips = barely tried, Touch Tongue = tasted, Bite = one bite, Multiple Bites = ate some.' },
                { name: 'Supplements Taken', help: 'Vitamins or supplements given with this meal. List all (e.g., "multivitamin, omega-3, probiotic").' },
                { name: 'Allergic Reaction', help: 'Check if any allergic symptoms appeared after eating.' },
                { name: 'Reaction Details', help: 'If reaction occurred, describe symptoms: hives, swelling, stomach pain, vomiting, breathing issues. Seek medical help for severe reactions.' },
                { name: 'Notes', help: 'Additional observations: eating speed, texture issues, mealtime behaviors, any gagging or food pocketing.' }
            ]
        },
        'bowel': {
            title: 'Bowel Entry',
            icon: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>',
            color: 'amber',
            description: 'Track digestive health',
            fields: [
                { name: 'Bristol Scale (1-7)', help: 'Stool consistency scale: 1-2 = constipation (hard lumps), 3-4 = ideal (smooth, soft), 5-6 = lacking fiber (soft blobs, mushy), 7 = diarrhea (liquid). Target is 3-4.' },
                { name: 'Pain Level (1-10)', help: 'Discomfort during bowel movement. 1 = no pain, 5 = moderate discomfort, 10 = severe pain. Track to identify constipation or other issues.' },
                { name: 'Had Accident', help: 'Check if a toileting accident occurred. No judgment - tracking helps identify patterns and measure progress.' },
                { name: 'Blood Present', help: 'Check if blood was observed in stool. If this occurs regularly, please consult with your healthcare provider.' },
                { name: 'Notes', help: 'Additional observations: straining, fear of toilet, timing patterns, color concerns.' }
            ]
        },
        'speech': {
            title: 'Speech Entry',
            icon: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path></svg>',
            color: 'teal',
            description: 'Track communication and speech progress',
            fields: [
                { name: 'Verbal Output (1-5)', help: 'Amount of speech: 1 = non-verbal/no words, 2 = single words only, 3 = short phrases, 4 = sentences, 5 = very talkative/paragraphs.' },
                { name: 'Clarity (1-5)', help: 'How understandable their speech was: 1 = unintelligible, 2 = mostly unclear, 3 = understood with effort, 4 = mostly clear, 5 = perfectly clear.' },
                { name: 'New Words', help: 'Words used for the first time! List any new vocabulary, even if pronunciation wasn\'t perfect. Celebrate progress!' },
                { name: 'Lost Words', help: 'Words previously used but not used today. Speech regression can be important to track and discuss with therapists.' },
                { name: 'Echolalia Level (0-5)', help: 'Repetition of words/phrases (immediate or delayed): 0 = none, 1-2 = occasional, 3 = moderate, 4-5 = frequent/constant. Note: echolalia can be communicative.' },
                { name: 'Communication Attempts', help: 'Total times child tried to communicate (verbal, gestures, AAC device, pointing). Counts all attempts, successful or not.' },
                { name: 'Successful Communications', help: 'Times the communication was understood and responded to appropriately. Helps track functional communication progress.' },
                { name: 'Notes', help: 'Additional observations: specific phrases used, context of communication, AAC usage, frustration levels.' }
            ]
        },
        'sensory': {
            title: 'Sensory Entry',
            icon: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"></path></svg>',
            color: 'orange',
            description: 'Record sensory processing and regulation',
            fields: [
                { name: 'Overall Regulation (1-5)', help: '1 = Very Dysregulated (constantly overwhelmed, frequent meltdowns), 2 = Dysregulated (struggling throughout day), 3 = Moderate (some difficulties), 4 = Regulated (managed well), 5 = Well Regulated (calm and organized).' },
                { name: 'Overload Episodes', help: 'Count of sensory overload events - when environmental input became too much. Signs: covering ears, meltdowns, fleeing, shutting down.' },
                { name: 'Overload Triggers', help: 'What caused overload? Common triggers: loud noises, bright lights, crowds, certain textures, strong smells, unexpected touch. List comma-separated.' },
                { name: 'Sensory Seeking Behaviors', help: 'Self-regulation attempts: spinning, jumping, crashing into things, deep pressure seeking, mouthing objects, loud vocalizations. List what you observed.' },
                { name: 'Calming Strategies Used', help: 'What helped them regulate? Examples: weighted blanket, quiet space, noise-canceling headphones, deep pressure, fidgets, swing, sensory bin.' }
            ]
        },
        'social': {
            title: 'Social Entry',
            icon: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>',
            color: 'cyan',
            description: 'Track social interactions and play',
            fields: [
                { name: 'Eye Contact Level (1-5)', help: '1 = None (actively avoids), 2 = Minimal (brief/accidental), 3 = Some (with prompting or familiar people), 4 = Good (initiates sometimes), 5 = Excellent (natural and consistent).' },
                { name: 'Social Engagement (1-5)', help: '1 = Withdrawn (ignored others), 2 = Low (minimal response to others), 3 = Moderate (some interaction), 4 = Good (engaged willingly), 5 = Very Engaged (sought out interaction).' },
                { name: 'Peer Interactions', help: 'Count of interactions with other children (not adults). Include brief exchanges, not just extended play.' },
                { name: 'Positive Interactions', help: 'Count of successful/positive social exchanges. Sharing, turn-taking, friendly conversation, cooperative play.' },
                { name: 'Conflicts', help: 'Count of social problems: arguments, grabbing toys, hitting, exclusion, misunderstandings. Track to identify social skill needs.' },
                { name: 'Parallel Play (minutes)', help: 'Time playing near other children but not directly with them. Same activity, same space, but independent play.' },
                { name: 'Cooperative Play (minutes)', help: 'Time playing together with others - shared goals, turn-taking, interactive games. True collaborative play.' }
            ]
        },
        'therapy': {
            title: 'Therapy Entry',
            icon: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path></svg>',
            color: 'indigo',
            description: 'Log therapy sessions and progress',
            fields: [
                { name: 'Therapy Type', help: 'Type of therapy: ABA (Applied Behavior Analysis), Speech, Occupational (OT), Physical (PT), Behavioral, or Other. Select the one that best describes the session.' },
                { name: 'Duration (minutes)', help: 'Length of the therapy session. Standard sessions are often 30, 45, or 60 minutes.' },
                { name: 'Therapist Name', help: 'Name of the therapist (optional). Helpful for tracking progress with different providers.' },
                { name: 'Goals Worked On', help: 'Skills or IEP goals addressed in the session. List comma-separated (e.g., "requesting, joint attention, fine motor"). Helps track goal progress over time.' },
                { name: 'Progress Notes', help: 'How did the session go? Breakthroughs, challenges, mood during therapy, compliance level, specific achievements.' },
                { name: 'Homework Assigned', help: 'Practice activities to do at home before next session. Recording this helps ensure follow-through and track home practice.' }
            ]
        },
        'seizure': {
            title: 'Seizure Entry',
            icon: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>',
            color: 'rose',
            description: 'Document seizure episodes',
            fields: [
                { name: 'Time of Seizure', help: 'When the seizure occurred. Required field. Be as accurate as possible for medical records.' },
                { name: 'Duration (seconds)', help: 'How long the seizure lasted. Time it if possible. Call 911 if seizure lasts more than 5 minutes.' },
                { name: 'Seizure Type', help: 'Absence = brief staring/unresponsive, Tonic-Clonic = convulsions/stiffening, Focal = one body part, Myoclonic = brief jerks, Atonic = sudden loss of muscle tone, Unknown = if unsure.' },
                { name: 'Triggers', help: 'What might have caused the seizure? Lack of sleep, missed medication, flashing lights, illness, stress, overheating.' },
                { name: 'Warning Signs', help: 'Pre-seizure symptoms (aura): strange feeling, visual changes, dizziness, nausea, deja vu, unusual taste/smell.' },
                { name: 'Post-Ictal Symptoms', help: 'After-effects: confusion, fatigue, headache, muscle soreness, memory gaps, difficulty speaking. Note duration of recovery.' },
                { name: 'Rescue Medication Given', help: 'Check if emergency seizure medication was administered (e.g., Diastat, Nayzilam, Valtoco).' },
                { name: 'Rescue Medication Name', help: 'Name of the rescue medication given.' },
                { name: 'Called 911', help: 'Check if emergency services were called. Call 911 for: first seizure, seizure > 5 minutes, injury, breathing problems, or doesn\'t wake up.' },
                { name: 'Notes', help: 'Additional details: what they were doing before, recovery observations, anything unusual. This information is valuable for neurologists.' }
            ]
        },
        'weight': {
            title: 'Weight/Growth Entry',
            icon: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3"></path></svg>',
            color: 'pink',
            description: 'Track weight and height measurements',
            fields: [
                { name: 'Weight (lbs)', help: 'Current weight in pounds. For accurate tracking, weigh at the same time of day, with similar clothing.' },
                { name: 'Height (inches)', help: 'Current height in inches. Measure against a wall with bare feet, looking straight ahead.' },
                { name: 'Notes', help: 'Growth observations: clothing size changes, appetite changes, concerns about weight gain/loss. Note any recent illness that might affect measurements.' }
            ]
        },
        'medication': {
            title: 'As-Needed Medication',
            icon: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg>',
            color: 'blue',
            description: 'Log PRN (as needed) medications',
            fields: [
                { name: 'Medication Name', help: 'Name of the as-needed medication given (e.g., Tylenol, Benadryl, rescue inhaler). Required field.' },
                { name: 'Dosage', help: 'Amount given (e.g., "10mg", "5ml", "1 tablet"). Include units for clarity.' },
                { name: 'Notes', help: 'Why was this medication given? Symptoms observed, effectiveness, any side effects noticed.' }
            ]
        }
    }
};

// Context detection from URL
function getHelpContext() {
    const path = window.location.pathname;
    if (path === '/dashboard') return 'dashboard';
    if (path.match(/^\/child\/[^/]+$/)) return 'child-dashboard';
    if (path.includes('/logs')) return 'daily-logs';
    if (path.includes('/medications')) return 'medications';
    if (path.match(/\/alert\/.*\/analysis/)) return 'alerts';
    if (path.includes('/alerts')) return 'alerts';
    if (path.includes('/insights')) return 'insights';
    if (path === '/chat') return 'chat';
    if (path === '/settings') return 'settings';
    if (path.includes('/settings') && path.includes('/child/')) return 'child-settings';
    if (path === '/child/new') return 'new-child';
    if (path === '/family/new') return 'new-family';
    if (path === '/login') return 'dashboard';
    if (path === '/register') return 'dashboard';
    return 'dashboard';
}

// Initialize help modal content
function initHelpContent() {
    // Build pages grid
    const pagesGrid = document.getElementById('helpPagesGrid');
    const sidebarPages = document.getElementById('sidebarPages');

    Object.entries(helpData.pages).forEach(([key, page]) => {
        // Grid card
        pagesGrid.innerHTML += `
            <div class="help-topic p-4 bg-gray-50 dark:bg-gray-700 rounded-lg hover:bg-${page.color}-50 dark:hover:bg-gray-600 cursor-pointer transition-colors border border-transparent hover:border-${page.color}-200" onclick="showPageHelp('${key}')">
                <div class="flex items-center mb-2">
                    <span class="text-${page.color}-600 dark:text-${page.color}-400 mr-2">${page.icon}</span>
                    <h3 class="font-semibold text-gray-900 dark:text-white">${page.title}</h3>
                </div>
                <p class="text-sm text-gray-600 dark:text-gray-300">${page.description}</p>
            </div>
        `;

        // Sidebar link
        sidebarPages.innerHTML += `
            <button onclick="showPageHelp('${key}')" class="w-full text-left px-3 py-2 text-sm rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 flex items-center" data-page="${key}">
                <span class="text-${page.color}-500 mr-2">${page.icon}</span>
                <span class="truncate">${page.title}</span>
            </button>
        `;
    });

    // Build forms grid
    const formsGrid = document.getElementById('helpFormsGrid');
    const sidebarForms = document.getElementById('sidebarForms');

    Object.entries(helpData.entryForms).forEach(([key, form]) => {
        // Grid card
        formsGrid.innerHTML += `
            <div class="help-topic p-3 bg-gray-50 dark:bg-gray-700 rounded-lg hover:bg-${form.color}-50 dark:hover:bg-gray-600 cursor-pointer transition-colors border border-transparent hover:border-${form.color}-200" onclick="showFormHelp('${key}')">
                <div class="flex items-center">
                    <span class="text-${form.color}-600 dark:text-${form.color}-400 mr-2">${form.icon}</span>
                    <h3 class="font-medium text-gray-900 dark:text-white text-sm">${form.title}</h3>
                </div>
            </div>
        `;

        // Sidebar link
        sidebarForms.innerHTML += `
            <button onclick="showFormHelp('${key}')" class="w-full text-left px-3 py-2 text-sm rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 flex items-center" data-form="${key}">
                <span class="text-${form.color}-500 mr-2">${form.icon}</span>
                <span class="truncate">${form.title}</span>
            </button>
        `;
    });
}

// Open help modal with context
function openHelpModal(context = null) {
    document.getElementById('helpModal').classList.remove('hidden');
    document.getElementById('helpSearchInput').value = '';

    const ctx = context || getHelpContext();

    if (helpData.pages[ctx]) {
        showPageHelp(ctx);
    } else {
        showHelpHome();
    }
}

function closeHelpModal() {
    document.getElementById('helpModal').classList.add('hidden');
}

function showHelpHome() {
    document.getElementById('helpHome').classList.remove('hidden');
    document.getElementById('helpTopicDetail').classList.add('hidden');
    document.getElementById('helpSearchResults').classList.add('hidden');
    document.getElementById('helpBreadcrumb').classList.add('hidden');

    // Clear active states
    document.querySelectorAll('[data-page], [data-form]').forEach(el => {
        el.classList.remove('bg-indigo-100', 'dark:bg-indigo-900', 'text-indigo-700', 'dark:text-indigo-300');
    });
}

function showPageHelp(pageKey) {
    const page = helpData.pages[pageKey];
    if (!page) return;

    document.getElementById('helpHome').classList.add('hidden');
    document.getElementById('helpSearchResults').classList.add('hidden');
    document.getElementById('helpTopicDetail').classList.remove('hidden');

    // Update breadcrumb
    document.getElementById('helpBreadcrumb').classList.remove('hidden');
    document.getElementById('breadcrumbSeparator').classList.remove('hidden');
    document.getElementById('breadcrumbCurrent').textContent = page.title;

    // Update active state in sidebar
    document.querySelectorAll('[data-page], [data-form]').forEach(el => {
        el.classList.remove('bg-indigo-100', 'dark:bg-indigo-900', 'text-indigo-700', 'dark:text-indigo-300');
    });
    const activeBtn = document.querySelector(`[data-page="${pageKey}"]`);
    if (activeBtn) {
        activeBtn.classList.add('bg-indigo-100', 'dark:bg-indigo-900', 'text-indigo-700', 'dark:text-indigo-300');
    }

    document.getElementById('helpTopicDetail').innerHTML = `
        <div class="flex items-center mb-4">
            <span class="text-${page.color}-600 dark:text-${page.color}-400 mr-3">${page.icon}</span>
            <h3 class="text-xl font-bold text-gray-900 dark:text-white">${page.title}</h3>
        </div>
        <div class="prose dark:prose-invert max-w-none">
            ${page.content}
        </div>
    `;
}

function showFormHelp(formKey) {
    const form = helpData.entryForms[formKey];
    if (!form) return;

    document.getElementById('helpHome').classList.add('hidden');
    document.getElementById('helpSearchResults').classList.add('hidden');
    document.getElementById('helpTopicDetail').classList.remove('hidden');

    // Update breadcrumb
    document.getElementById('helpBreadcrumb').classList.remove('hidden');
    document.getElementById('breadcrumbSeparator').classList.remove('hidden');
    document.getElementById('breadcrumbCurrent').textContent = form.title;

    // Update active state in sidebar
    document.querySelectorAll('[data-page], [data-form]').forEach(el => {
        el.classList.remove('bg-indigo-100', 'dark:bg-indigo-900', 'text-indigo-700', 'dark:text-indigo-300');
    });
    const activeBtn = document.querySelector(`[data-form="${formKey}"]`);
    if (activeBtn) {
        activeBtn.classList.add('bg-indigo-100', 'dark:bg-indigo-900', 'text-indigo-700', 'dark:text-indigo-300');
    }

    let fieldsHtml = form.fields.map(field => `
        <div class="border-b dark:border-gray-600 pb-3 last:border-0">
            <h5 class="font-medium text-gray-900 dark:text-white mb-1">${field.name}</h5>
            <p class="text-sm text-gray-600 dark:text-gray-300">${field.help}</p>
        </div>
    `).join('');

    document.getElementById('helpTopicDetail').innerHTML = `
        <div class="flex items-center mb-4">
            <span class="text-${form.color}-600 dark:text-${form.color}-400 mr-3">${form.icon}</span>
            <h3 class="text-xl font-bold text-gray-900 dark:text-white">${form.title}</h3>
        </div>
        <p class="text-gray-600 dark:text-gray-300 mb-4">${form.description}</p>
        <h4 class="font-semibold text-gray-900 dark:text-white mb-3">Field Guide</h4>
        <div class="space-y-3">
            ${fieldsHtml}
        </div>
    `;
}

function searchHelp(query) {
    const lowerQuery = query.toLowerCase().trim();

    if (!lowerQuery) {
        showHelpHome();
        return;
    }

    document.getElementById('helpHome').classList.add('hidden');
    document.getElementById('helpTopicDetail').classList.add('hidden');
    document.getElementById('helpSearchResults').classList.remove('hidden');
    document.getElementById('helpBreadcrumb').classList.remove('hidden');
    document.getElementById('breadcrumbSeparator').classList.remove('hidden');
    document.getElementById('breadcrumbCurrent').textContent = `Search: "${query}"`;

    let results = [];

    // Search pages
    Object.entries(helpData.pages).forEach(([key, page]) => {
        if (page.title.toLowerCase().includes(lowerQuery) ||
            page.description.toLowerCase().includes(lowerQuery) ||
            page.content.toLowerCase().includes(lowerQuery)) {
            results.push({
                type: 'page',
                key: key,
                title: page.title,
                description: page.description,
                icon: page.icon,
                color: page.color
            });
        }
    });

    // Search forms and fields
    Object.entries(helpData.entryForms).forEach(([key, form]) => {
        if (form.title.toLowerCase().includes(lowerQuery) ||
            form.description.toLowerCase().includes(lowerQuery)) {
            results.push({
                type: 'form',
                key: key,
                title: form.title,
                description: form.description,
                icon: form.icon,
                color: form.color
            });
        }

        // Search individual fields
        form.fields.forEach(field => {
            if (field.name.toLowerCase().includes(lowerQuery) ||
                field.help.toLowerCase().includes(lowerQuery)) {
                results.push({
                    type: 'field',
                    formKey: key,
                    title: `${field.name} (${form.title})`,
                    description: field.help.substring(0, 100) + '...',
                    icon: form.icon,
                    color: form.color
                });
            }
        });
    });

    // Display results
    const resultsContainer = document.getElementById('helpSearchResults');

    if (results.length === 0) {
        resultsContainer.innerHTML = `
            <div class="text-center py-8">
                <svg class="w-12 h-12 text-gray-400 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <p class="text-gray-500 dark:text-gray-400">No results found for "${query}"</p>
                <p class="text-sm text-gray-400 dark:text-gray-500 mt-1">Try different keywords</p>
            </div>
        `;
    } else {
        resultsContainer.innerHTML = `
            <p class="text-sm text-gray-500 dark:text-gray-400 mb-4">${results.length} result${results.length !== 1 ? 's' : ''} found</p>
            <div class="space-y-2">
                ${results.map(r => `
                    <div class="p-3 bg-gray-50 dark:bg-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 cursor-pointer" onclick="${r.type === 'page' ? `showPageHelp('${r.key}')` : `showFormHelp('${r.type === 'field' ? r.formKey : r.key}')`}">
                        <div class="flex items-center mb-1">
                            <span class="text-${r.color}-600 dark:text-${r.color}-400 mr-2">${r.icon}</span>
                            <span class="font-medium text-gray-900 dark:text-white">${r.title}</span>
                            <span class="ml-2 text-xs px-2 py-0.5 rounded bg-gray-200 dark:bg-gray-600 text-gray-600 dark:text-gray-300">${r.type}</span>
                        </div>
                        <p class="text-sm text-gray-600 dark:text-gray-300 ml-7">${r.description}</p>
                    </div>
                `).join('')}
            </div>
        `;
    }
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', initHelpContent);

// Close on escape
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        closeHelpModal();
    }
});

// Close on click outside
document.addEventListener('click', function(event) {
    const helpModal = document.getElementById('helpModal');
    if (event.target === helpModal) {
        closeHelpModal();
    }
});
</script>
{{end}}
