{{define "content"}}
<div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold text-gray-800">Support Tickets</h1>
    <div class="flex space-x-3">
        <select id="statusFilter" onchange="filterTickets()" class="px-3 py-2 border rounded">
            <option value="">All Status</option>
            <option value="open">Open</option>
            <option value="in_progress">In Progress</option>
            <option value="waiting_on_user">Waiting on User</option>
            <option value="resolved">Resolved</option>
            <option value="closed">Closed</option>
        </select>
    </div>
</div>

<div class="bg-white rounded-lg shadow overflow-hidden">
    <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
            <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Subject</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">User</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Priority</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Assignee</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Created</th>
            </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
            {{range .Data.tickets}}
            <tr class="hover:bg-gray-50 cursor-pointer" onclick="window.location='/admin/tickets/{{.ID}}'">
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{slice .ID.String 0 8}}...</td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="text-sm font-medium text-gray-900">{{.Subject}}</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{.UserEmail}}</td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 py-1 text-xs rounded-full
                        {{if eq .Priority "urgent"}}bg-red-100 text-red-800
                        {{else if eq .Priority "high"}}bg-orange-100 text-orange-800
                        {{else if eq .Priority "normal"}}bg-blue-100 text-blue-800
                        {{else}}bg-gray-100 text-gray-800{{end}}">
                        {{.Priority}}
                    </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 py-1 text-xs rounded-full
                        {{if eq .Status "open"}}bg-green-100 text-green-800
                        {{else if eq .Status "in_progress"}}bg-blue-100 text-blue-800
                        {{else if eq .Status "resolved"}}bg-gray-100 text-gray-800
                        {{else}}bg-yellow-100 text-yellow-800{{end}}">
                        {{.Status}}
                    </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{if .AssigneeName}}{{.AssigneeName}}{{else}}-{{end}}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{.CreatedAt.Format "Jan 2, 2006"}}</td>
            </tr>
            {{else}}
            <tr>
                <td colspan="7" class="px-6 py-4 text-center text-gray-500">No tickets found</td>
            </tr>
            {{end}}
        </tbody>
    </table>
</div>

<script>
function filterTickets() {
    const status = document.getElementById('statusFilter').value;
    window.location = '/admin/tickets' + (status ? '?status=' + status : '');
}
</script>
{{end}}
