{{define "content"}}
<div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold text-gray-800">Admin Users</h1>
    <button onclick="showAddModal()" class="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700">
        Add Admin
    </button>
</div>

<div class="bg-white rounded-lg shadow overflow-hidden">
    <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
            <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Role</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
            </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
            {{range .Data}}
            <tr>
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="text-sm font-medium text-gray-900">{{.FirstName}} {{.LastName}}</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{.Email}}</td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 py-1 text-xs rounded-full
                        {{if eq .SystemRole.String "super_admin"}}bg-purple-100 text-purple-800
                        {{else if eq .SystemRole.String "support"}}bg-blue-100 text-blue-800
                        {{else}}bg-green-100 text-green-800{{end}}">
                        {{.SystemRole.String}}
                    </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <span class="px-2 py-1 text-xs rounded-full
                        {{if eq .Status "active"}}bg-green-100 text-green-800{{else}}bg-red-100 text-red-800{{end}}">
                        {{.Status}}
                    </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm">
                    <button onclick="editAdmin('{{.ID}}', '{{.SystemRole.String}}')" class="text-indigo-600 hover:text-indigo-900 mr-3">Edit</button>
                    <button onclick="removeAdmin('{{.ID}}')" class="text-red-600 hover:text-red-900">Remove</button>
                </td>
            </tr>
            {{else}}
            <tr>
                <td colspan="5" class="px-6 py-4 text-center text-gray-500">No admin users found</td>
            </tr>
            {{end}}
        </tbody>
    </table>
</div>

<!-- Add Admin Modal -->
<div id="addModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-lg p-6 w-full max-w-md">
        <h2 class="text-xl font-bold mb-4">Add Admin User</h2>
        <form id="addForm">
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                <input type="email" name="email" required class="w-full px-3 py-2 border rounded">
            </div>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                <input type="password" name="password" required class="w-full px-3 py-2 border rounded">
            </div>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">First Name</label>
                <input type="text" name="first_name" required class="w-full px-3 py-2 border rounded">
            </div>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">Last Name</label>
                <input type="text" name="last_name" class="w-full px-3 py-2 border rounded">
            </div>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-1">Role</label>
                <select name="role" required class="w-full px-3 py-2 border rounded">
                    <option value="super_admin">Super Admin</option>
                    <option value="support">Support</option>
                    <option value="marketing">Marketing</option>
                </select>
            </div>
            <div class="flex justify-end space-x-3">
                <button type="button" onclick="hideAddModal()" class="px-4 py-2 border rounded hover:bg-gray-100">Cancel</button>
                <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700">Add</button>
            </div>
        </form>
    </div>
</div>

<script>
function showAddModal() {
    document.getElementById('addModal').classList.remove('hidden');
    document.getElementById('addModal').classList.add('flex');
}
function hideAddModal() {
    document.getElementById('addModal').classList.add('hidden');
    document.getElementById('addModal').classList.remove('flex');
}
document.getElementById('addForm').onsubmit = async (e) => {
    e.preventDefault();
    const form = e.target;
    const data = {
        email: form.email.value,
        password: form.password.value,
        first_name: form.first_name.value,
        last_name: form.last_name.value,
        role: form.role.value
    };
    await apiCall('POST', '/api/admin/super/admins', data);
    location.reload();
};
async function editAdmin(id, currentRole) {
    const newRole = prompt('Enter new role (super_admin, support, marketing):', currentRole);
    if (newRole && ['super_admin', 'support', 'marketing'].includes(newRole)) {
        await apiCall('PUT', '/api/admin/super/admins/' + id, { role: newRole });
        location.reload();
    }
}
async function removeAdmin(id) {
    if (confirm('Remove admin role from this user?')) {
        await apiCall('DELETE', '/api/admin/super/admins/' + id);
        location.reload();
    }
}
</script>
{{end}}
